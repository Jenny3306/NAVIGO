<!DOCTYPE html>
<html lang="vi">
<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Báº£n Äá»“ TrÆ°á»ng - Navigo</title>
</head>
<body>
    <div class="login-container" id="loginScreen">
        <div class="login-header">
            <h1>ğŸ—ºï¸ Báº£n Äá»“ TrÆ°á»ng - Navigo</h1>
            <p>ÄÄƒng nháº­p Ä‘á»ƒ lÆ°u tiáº¿n Ä‘á»™</p>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <button type="button" class="skip-btn" onclick="skipLogin()">Bá» qua Ä‘Äƒng nháº­p</button>

        <form id="loginForm">
            <div class="form-group">
                <label>TÃªn Ä‘Äƒng nháº­p</label>
                <input type="text" id="username" placeholder="Nháº­p tÃªn Ä‘Äƒng nháº­p" required>
            </div>
            <div class="form-group">
                <label>Máº­t kháº©u</label>
                <input type="password" id="password" placeholder="Nháº­p máº­t kháº©u" required>
            </div>
            <button type="submit" class="submit-btn" id="loginBtn">ÄÄƒng nháº­p</button>
        </form>

        <div class="form-toggle">
            <span id="toggleText">ChÆ°a cÃ³ tÃ i khoáº£n? </span>
            <a onclick="toggleForm()">ÄÄƒng kÃ½ ngay</a>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <div class="logo-section">
            <div class="logo-item">
                <img src="logo_navigo.png" alt="Logo Navigo" onerror="this.style.display='none'">
            </div>
            <div class="logo-item">
                <img src="logo_bk.png" alt="Logo BK" onerror="this.style.display='none'">
            </div>
        </div>

        <div class="header">
            <div class="user-info" id="userInfo">
                <span>ğŸ‘¤ <span id="currentUser"></span></span>
                <span id="userBadgeDisplay"></span>
                <button class="notification-btn" id="notificationBtn" onclick="toggleNotifications()" style="display:none;position:relative;">
                    ğŸ””
                    <span id="notificationBadge" class="notification-badge" style="display:none;"></span>
                </button>
                <button class="logout-btn" id="logoutBtn" onclick="logout()">ÄÄƒng xuáº¥t</button>
            </div>
            <h1>ğŸ—ºï¸ Báº£n Äá»“ TrÆ°á»ng</h1>
            
            <div id="statsContainer">
                <div class="stats-container">
                    <div class="stat-box">
                        <div class="stat-number" id="totalPoints">0</div>
                        <div class="stat-label">Tá»•ng Ä‘iá»ƒm</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="currentCycle">1</div>
                        <div class="stat-label">VÃ²ng hiá»‡n táº¡i</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="cycleProgress">0/45</div>
                        <div class="stat-label">VÃ²ng nÃ y</div>
                    </div>
                </div>

                <div class="current-badge-display" id="currentBadgeDisplay">
                    <div class="badge-icon-large" id="currentBadgeIcon">ğŸ†</div>
                    <div class="badge-name-large" id="currentBadgeName">ChÆ°a cÃ³ huy hiá»‡u</div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar">0/20</div>
                </div>
                <div class="progress-label" id="progressLabel">CÃ²n 20 Ä‘iá»ƒm ná»¯a Ä‘á»ƒ Ä‘áº¡t huy hiá»‡u tiáº¿p theo</div>
            </div>
        </div>

        <!-- Notification Panel -->
        <div class="notification-panel" id="notificationPanel">
            <div style="padding:15px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;">
                <h3 style="margin:0;color:#1e3c72;">ThÃ´ng bÃ¡o</h3>
                <button onclick="toggleNotifications()" style="background:transparent;border:none;font-size:20px;cursor:pointer;">Ã—</button>
            </div>
            <div id="notificationList" style="max-height:400px;overflow-y:auto;"></div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('navigate')">ğŸ“ Äiá»u HÆ°á»›ng</button>
            <button class="tab" onclick="switchTab('checkin')" id="checkinTab">âœ… Check-in</button>
            <button class="tab" onclick="switchTab('review')">â­ Review</button>
            <button class="tab" onclick="switchTab('voucher')" id="voucherTab">ğŸ Voucher</button>
            <button class="tab" onclick="switchTab('admin')" id="adminTab" style="display:none;">ğŸ‘® Admin</button>
        </div>

        <div class="content">
            <div id="navigate-content" class="tab-content active">
                <div class="location-grid" id="locationsList"></div>
            </div>

            <div id="checkin-content" class="tab-content">
                <div id="checkinList"></div>
            </div>

            <div id="review-content" class="tab-content">
                <div style="display:flex;gap:8px;margin-bottom:15px;overflow-x:auto;padding-bottom:5px;">
                    <button class="star-filter-btn active" onclick="filterByStar('all')" style="padding:8px 16px;background:white;border:2px solid #e2e8f0;border-radius:20px;font-size:13px;cursor:pointer;white-space:nowrap;">Táº¥t cáº£</button>
                    <button class="star-filter-btn" onclick="filterByStar(5)" style="padding:8px 16px;background:white;border:2px solid #e2e8f0;border-radius:20px;font-size:13px;cursor:pointer;white-space:nowrap;">â­ 5 sao</button>
                    <button class="star-filter-btn" onclick="filterByStar(4)" style="padding:8px 16px;background:white;border:2px solid #e2e8f0;border-radius:20px;font-size:13px;cursor:pointer;white-space:nowrap;">â­ 4 sao</button>
                    <button class="star-filter-btn" onclick="filterByStar(3)" style="padding:8px 16px;background:white;border:2px solid #e2e8f0;border-radius:20px;font-size:13px;cursor:pointer;white-space:nowrap;">â­ 3 sao</button>
                    <button class="star-filter-btn" onclick="filterByStar(2)" style="padding:8px 16px;background:white;border:2px solid #e2e8f0;border-radius:20px;font-size:13px;cursor:pointer;white-space:nowrap;">â­ 2 sao</button>
                    <button class="star-filter-btn" onclick="filterByStar(1)" style="padding:8px 16px;background:white;border:2px solid #e2e8f0;border-radius:20px;font-size:13px;cursor:pointer;white-space:nowrap;">â­ 1 sao</button>
                </div>
                <div style="display:flex;gap:8px;margin-bottom:15px;overflow-x:auto;padding-bottom:5px;">
                    <button class="filter-btn active" onclick="filterReviews('all')" style="padding:8px 16px;background:#1e3c72;color:white;border:2px solid #1e3c72;border-radius:20px;font-size:13px;cursor:pointer;white-space:nowrap;">Táº¥t cáº£</button>
                    <button class="filter-btn" onclick="filterReviews('food')" style="padding:8px 16px;background:white;border:2px solid #e2e8f0;border-radius:20px;font-size:13px;cursor:pointer;white-space:nowrap;">ğŸ½ï¸ QuÃ¡n Äƒn</button>
                    <button class="filter-btn" onclick="filterReviews('wc')" style="padding:8px 16px;background:white;border:2px solid #e2e8f0;border-radius:20px;font-size:13px;cursor:pointer;white-space:nowrap;">ğŸš» NhÃ  vá»‡ sinh</button>
                    <button class="filter-btn" onclick="filterReviews('other')" style="padding:8px 16px;background:white;border:2px solid #e2e8f0;border-radius:20px;font-size:13px;cursor:pointer;white-space:nowrap;">ğŸ“Œ KhÃ¡c</button>
                </div>
                <div id="reviewList"></div>
            </div>

            <div id="voucher-content" class="tab-content">
                <div id="voucherList"></div>
            </div>

            <div id="admin-content" class="tab-content">
                <div class="admin-panel">
                    <div class="admin-section">
                        <h3>âš™ï¸ Quáº£n lÃ½ Check-in</h3>
                        <button class="admin-btn" onclick="adminResetCheckin()">ğŸ”„ Reset tiáº¿n Ä‘á»™ check-in hiá»‡n táº¡i</button>
                        <button class="admin-btn" onclick="adminResetAll()">ğŸ—‘ï¸ Reset toÃ n bá»™ dá»¯ liá»‡u</button>
                    </div>

                    <div class="admin-section">
                        <h3>ğŸ YÃªu cáº§u sá»­ dá»¥ng Voucher</h3>
                        <div id="adminVoucherUsage"></div>
                    </div>

                    <div class="admin-section">
                        <h3>ğŸ” TÃ¬m voucher Ä‘Ã£ dÃ¹ng</h3>
                        <div style="display:flex;gap:8px;margin-bottom:10px;">
                            <input type="text" id="searchUsername" class="admin-input" placeholder="Nháº­p tÃªn ngÆ°á»i dÃ¹ng" style="flex:1;">
                            <button class="admin-btn" onclick="adminSearchUser()" style="flex:0;white-space:nowrap;">TÃ¬m kiáº¿m</button>
                        </div>
                        <div id="userVoucherList"></div>
                    </div>

                    <div class="admin-section" id="adminReports">
                        <h3>âš ï¸ BÃ¡o cÃ¡o vi pháº¡m</h3>
                        <div id="adminReportsList"></div>
                    </div>

                    <div class="admin-section">
                        <h3>ğŸ ThÃªm Voucher</h3>
                        <input type="text" class="admin-input" id="voucherTitle" placeholder="TÃªn voucher (VD: Giáº£m 30k TrÃ  ÄÃ©)">
                        <input type="text" class="admin-input" id="voucherValue" placeholder="GiÃ¡ trá»‹ (VD: 30K)">
                        <input type="text" class="admin-input" id="voucherDesc" placeholder="MÃ´ táº£ Ä‘iá»u kiá»‡n">
                        <input type="number" class="admin-input" id="voucherRequired" placeholder="Sá»‘ Ä‘iá»ƒm yÃªu cáº§u">
                        <input type="text" class="admin-input" id="voucherBadge" placeholder="Icon (VD: ğŸ)">
                        <button class="admin-btn" style="background:#10b981;" onclick="adminAddVoucher()">âœ… ThÃªm Voucher</button>
                    </div>

                    <div class="admin-section">
                        <h3>ğŸ† ThÃªm Huy Hiá»‡u</h3>
                        <input type="text" class="admin-input" id="badgeName" placeholder="TÃªn huy hiá»‡u">
                        <input type="number" class="admin-input" id="badgeRequired" placeholder="Sá»‘ Ä‘iá»ƒm yÃªu cáº§u">
                        <input type="text" class="admin-input" id="badgeIcon" placeholder="Icon (VD: ğŸ’)">
                        <input type="text" class="admin-input" id="badgeImage" placeholder="TÃªn file áº£nh (VD: diamond.png)">
                        <button class="admin-btn" style="background:#10b981;" onclick="adminAddBadge()">âœ… ThÃªm Huy Hiá»‡u</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="qr-scan-btn" id="qrScanBtn" onclick="openQRScanner()" style="display: none;">ğŸ“·</button>
    <button style="position:fixed;bottom:20px;left:20px;width:60px;height:60px;background:linear-gradient(135deg,#10b981 0%,#059669 100%);border:none;border-radius:50%;color:white;font-size:28px;cursor:pointer;box-shadow:0 8px 25px rgba(16,185,129,0.4);z-index:999;display:none;" id="createReviewBtn" onclick="openReviewForm()">âœï¸</button>

    <!-- Review Form Modal -->
    <div class="modal" id="reviewFormModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeReviewForm()">Ã—</button>
            <h3 style="color:#1e3c72;margin-bottom:15px;font-size:18px;">âœï¸ Viáº¿t Ä‘Ã¡nh giÃ¡</h3>
            <select id="reviewCategory" style="width:100%;padding:10px;border:2px solid #e2e8f0;border-radius:10px;font-size:14px;margin-bottom:10px;">
                <option value="">Chá»n loáº¡i Ä‘á»‹a Ä‘iá»ƒm</option>
                <option value="food">ğŸ½ï¸ QuÃ¡n Äƒn</option>
                <option value="wc">ğŸš» NhÃ  vá»‡ sinh</option>
                <option value="other">ğŸ“Œ KhÃ¡c</option>
            </select>
            <input type="text" id="reviewLocationName" placeholder="TÃªn Ä‘á»‹a Ä‘iá»ƒm (VD: QuÃ¡n xÃ´i cá»•ng 2)" style="width:100%;padding:10px;border:2px solid #e2e8f0;border-radius:10px;font-size:14px;margin-bottom:10px;">
            <div id="ratingInput" style="display:flex;gap:8px;margin-bottom:10px;font-size:24px;">
                <span data-rating="1" style="cursor:pointer;color:#d1d5db;">â˜…</span>
                <span data-rating="2" style="cursor:pointer;color:#d1d5db;">â˜…</span>
                <span data-rating="3" style="cursor:pointer;color:#d1d5db;">â˜…</span>
                <span data-rating="4" style="cursor:pointer;color:#d1d5db;">â˜…</span>
                <span data-rating="5" style="cursor:pointer;color:#d1d5db;">â˜…</span>
            </div>
            <textarea id="reviewText" placeholder="Viáº¿t Ä‘Ã¡nh giÃ¡ cá»§a báº¡n..." style="width:100%;padding:10px;border:2px solid #e2e8f0;border-radius:10px;font-size:14px;margin-bottom:10px;min-height:100px;resize:vertical;"></textarea>
            <div style="margin-bottom:10px;">
                <input type="file" id="reviewImageInput" accept="image/*" style="display:none;">
                <label for="reviewImageInput" style="display:inline-block;padding:10px 20px;background:#e0f2fe;color:#1e3c72;border-radius:10px;cursor:pointer;font-size:14px;">ğŸ“· ThÃªm áº£nh</label>
                <img id="imagePreview" style="max-width:200px;max-height:200px;border-radius:10px;margin-top:10px;display:none;">
            </div>
            <button onclick="submitReview()" style="width:100%;padding:12px;background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:white;border:none;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;">ÄÄƒng Ä‘Ã¡nh giÃ¡</button>
        </div>
    </div>

    <!-- Report Modal -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeReportModal()">Ã—</button>
            <h3 style="color:#ef4444;margin-bottom:15px;font-size:18px;">âš ï¸ BÃ¡o cÃ¡o vi pháº¡m</h3>
            <input type="hidden" id="reportContentType">
            <textarea id="reportReason" placeholder="Nháº­p lÃ½ do bÃ¡o cÃ¡o..." style="width:100%;padding:10px;border:2px solid #e2e8f0;border-radius:10px;font-size:14px;margin-bottom:10px;min-height:100px;resize:vertical;"></textarea>
            <button onclick="submitReport()" style="width:100%;padding:12px;background:#ef4444;color:white;border:none;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;">Gá»­i bÃ¡o cÃ¡o</button>
        </div>
    </div>

    <!-- QR Scanner Modal -->
    <div class="modal" id="qrScannerModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeQRScanner()">Ã—</button>
            <h2 style="color: #1e3c72; margin-bottom: 15px; font-size: 20px;">ğŸ“· QuÃ©t mÃ£ QR</h2>
            <div id="qrScanner"></div>
            <div style="text-align:center; margin-top:15px; color:#64748b; font-size:13px;">
                ÄÆ°a camera Ä‘áº¿n mÃ£ QR Ä‘á»ƒ check-in
            </div>
            <div class="manual-input">
                <input type="text" id="manualQRInput" placeholder="Hoáº·c nháº­p mÃ£ QR thá»§ cÃ´ng">
                <button onclick="manualQRSubmit()">XÃ¡c nháº­n</button>
            </div>
        </div>
    </div>

    <!-- Image Popup -->
    <div
    class="badge-popup-overlay"
    id="badgePopupOverlay"
    onclick="closeBadgePopup()"
    ></div>

    <img
    class="badge-popup-image"
    id="badgePopupImage"
    onclick="closeBadgePopup()"
    />

    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="app.js"></script>

</body>
</html>